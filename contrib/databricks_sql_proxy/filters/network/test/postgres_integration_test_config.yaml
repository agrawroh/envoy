admin:
  access_log:
  - name: envoy.access_loggers.file
    typed_config:
      "@type": type.googleapis.com/envoy.extensions.access_loggers.file.v3.FileAccessLog
      # Arg 1: admin access log path
      path: "{}"
  address:
    socket_address:
      # Arg 2: admin endpoint address
      address: "{}"
      port_value: 0
static_resources:
  clusters:
  - name: brickstore.database.databricks.com
    connect_timeout: 2s
    load_assignment:
      cluster_name: brickstore.database.databricks.com
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                # Arg 3: upstream cluster address
                address: "{}"
                port_value: 0
    # Transport socket configuration for the upstream cluster
    # Arg 4: upstream tls config
    {}
  - name: ext_authz-service
    connect_timeout: 2s
    type: static
    typed_extension_protocol_options:
      envoy.extensions.upstreams.http.v3.HttpProtocolOptions:
        "@type": type.googleapis.com/envoy.extensions.upstreams.http.v3.HttpProtocolOptions
        explicit_http_config:
          # Arg 5: http2_protocol_options
          http2_protocol_options: {}
    load_assignment:
      cluster_name: ext_authz-service
      endpoints:
      - lb_endpoints:
        - endpoint:
            address:
              socket_address:
                # Arg 6: ext_authz_service address
                address: "{}"
                port_value: 0
  listeners:
    name: listener_0
    address:
      socket_address:
        # Arg 7: listener address
        address: "{}"
        port_value: 0
    listener_filters:
      # Arg 8: Proxy protocol configuration if needed
      {}
      - name: "envoy.filters.listener.databricks_sql_inspector"
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.listener.databricks_sql_inspector.v3.DatabricksSqlInspector
          stat_prefix: "pg-listener"
          protocol: POSTGRES
    filter_chains:
    - filters:
      - name: databricks_sql_proxy
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.network.databricks_sql_proxy.v3.DatabricksSqlProxy
          stat_prefix: postgres_stats
          protocol: POSTGRES
          # Arg 9: enable_upstream_tls
          enable_upstream_tls: {}
          destination_cluster_source: SIDECAR_SERVICE
          ext_authz_service:
            envoy_grpc:
              cluster_name: ext_authz-service
      -  name: sync
         typed_config:
           "@type": type.googleapis.com/test.integration.databricks_sql_proxy.SyncWriteFilterConfig
      - name: tcp
        typed_config:
          "@type": type.googleapis.com/envoy.extensions.filters.network.tcp_proxy.v3.TcpProxy
          stat_prefix: tcp_stats
          cluster: postgres_cluster_westus
      transport_socket:
          name: "envoy.transport_sockets.tls"
          typed_config:
            "@type": "type.googleapis.com/envoy.extensions.transport_sockets.tls.v3.DownstreamTlsContext"
            common_tls_context:
              tls_certificates:
                - certificate_chain:
                    filename: "test/config/integration/certs/servercert.pem"
                  private_key:
                    filename: "test/config/integration/certs/serverkey.pem"
